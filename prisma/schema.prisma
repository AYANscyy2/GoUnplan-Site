generator client {
  provider = "prisma-client-js"
  output   = "../db/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  USER
  HOST
  ADMIN
}

enum BookingStatus {
  PENDING
  CONFIRMED
  CANCELLED
  REFUNDED
}

enum TravelPlanStatus {
  ACTIVE
  INACTIVE
}

model User {
  id             String       @id @default(cuid())
  email          String       @unique
  name           String
  bio            String?      @default("Travelling with vibe")
  phone          String       @unique
  password       String
  role           Role         @default(USER)
  image          String?      @default("https://avatar.iran.liara.run/public")
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  appliedForHost Boolean      @default(false)
  hostProfile    HostProfile?
  bookings       Booking[]

  @@map("users")
}

model HostProfile {
  hostId      String   @id @default(cuid())
  description String?
  image       String?  @default("https://avatar.iran.liara.run/public")
  hostMobile  String
  hostEmail   String   @unique
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  user        User          @relation(fields: [hostId], references: [id], onDelete: Cascade)
  travelPlans TravelPlans[]

  @@map("host_profiles")
}

model TravelPlans {
  travelPlanId       String           @id @default(cuid())
  title              String
  destination        String?          
  description        String
  filters            String[]         @default([])
  includedActivities String[]
  restrictions       String[]
  noOfDays           Int
  hostId             String
  price              Int
  languages          String[]         @default([])
  maxParticipants    Int              @default(10)
  country            String
  state              String
  city               String
  startDate          DateTime?       
  endDate            DateTime?   
  status             TravelPlanStatus @default(INACTIVE)
  createdAt          DateTime         @default(now())
  updatedAt          DateTime         @updatedAt

  host     HostProfile @relation(fields: [hostId], references: [hostId], onDelete: Cascade)
  bookings Booking[]

  @@map("travel_plans")
}

model Booking {
  id             String        @id @default(cuid())
  userId         String
  travelPlanId   String
  startDate      DateTime
  endDate        DateTime
  participants   Int           @default(1)
  pricePerPerson Int
  totalPrice     Int
  status         BookingStatus @default(PENDING)
  cancelledAt    DateTime?
  refundAmount   Int           @default(0)
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt


  user       User        @relation(fields: [userId], references: [id])
  travelPlan TravelPlans @relation(fields: [travelPlanId], references: [travelPlanId])

  @@map("bookings")
}
